<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



    <script src="./js/funcoes.js"></script>


    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/style_geral.css">
    <link rel="stylesheet" href="./css/cadastro.css">
    <link rel="shortcut icon" href="./assets/img/favicon-32x32.png" type="image/x-icon" />

    <title>Registro | Melvs</title>
</head>

<body>
    <header>
        <div class="containerPadrao">
            <div class="titulo">
                <a href="./index.html"><img src="./assets/img/melvs_logo.png" width="90px" alt=""></a>
                <li class="itens"> <a href="./index.html#nossaSolucao">Nossa Solução</a> </li>
                <li class="itens"> <a href="./index.html#quemSomos">Sobre Nós</a> </li>
                <li class="itens"> <a href="./simulador_financeiro.html">Simule</a> </li>
                <li class="itens"> <a href="./suporte.html">Duvidas Frequentes</a> </li>
                </ul>
            </div>
            <div class="nav">
                <ul class="nav">
                    <li class="itens">
                        <a href="./cadastro.html">
                            <button class="cadastrar">Cadastrar </button>
                        </a>
                    </li>
                    <li class="itens">
                        <a href="./login.html">
                            <button class="entrar">Entrar</button>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </header>
    <div class="banner ">
        <div class="alerta_erro">
            <div class="card_erro" id="cardErro">
                <span id="mensagem_erro"></span>
            </div>
        </div>
        <div class="principal-cadastro">
            <div class="esquerda-cadastro">
                <img src="./assets/img/forms-animate.svg" class="esquerda-cadastro-imagem"
                    alt="representação do cadastro">
            </div>
            <div class="direita-cadastro">
                <div class="card-cadastro">
                    <h1>Registro</h1>
                    <div class="campo">
                        <span class="span_titulo">Nome:</span>
                        <input type="text" id="nome_input" placeholder="Nome e sobrenome">
                        <span class="validacao" id="span_validacao_nome"></span>
                    </div>
                    <div class="campo">
                        <span class="span_titulo">Email:</span>
                        <input type="text" id="email_input" placeholder="usuario@email.com">
                        <span class="validacao" id="span_validacao_email"></span>
                    </div>
                    <div class="campo">
                        <span class="span_titulo">CPF:</span>
                        <input type="text" maxlength="11" id="cpf_input" placeholder="XXX.XXX.XXX-XX"
                            onkeyup="cpfPontos()">
                        <span class="validacao" id="span_validacao_cpf"></span>
                    </div>
                    <div class="organizar-senhas">
                        <div class="senha">
                            <div class="campo">
                                <span class="span_titulo">Senha:</span>
                                <input type="password" id="senha_input" placeholder="••••••">
                                <span class="validacao" id="span_validacao_senha"></span>
                            </div>
                        </div>
                        <div class="senha">
                            <div class="campo">
                                <span class="span_titulo">Confirme a senha:</span>
                                <input type="password" id="confirmacao_senha_input" placeholder="••••••">
                                <span class="validacao" id="span_validacao_confirme_senha"></span>
                            </div>
                        </div>
                    </div>
                    <button class="botao-cadastro" onclick="cadastrar()">Registrar</button>
                    <div id="div_aguardar" class="loading-div">
                        <img src="./assets/carregando.gif" id="loading-gif">
                    </div>
                </div>
                <div id="div_erros_login">

                </div>
            </div>
        </div>

        <footer>
            <div class="container">
                <div class="faleConosco">
                    <span class="titulo">Fale Conosco</span>
                    <div class="email">
                        <img src="./assets/icons/mail.png" alt="">
                        <span class="textoEmail">melvs@melvs.com</span>
                    </div>
                    <div class="tel">
                        <img src="./assets/icons/call.png" alt="" srcset="">
                        <span class="textoTell">(11)91234-5678</span>
                    </div>
                </div>
                <div class="imgFaleConosco">
                    <img src="./assets/img/melvs_logo.png" alt="">
                </div>
            </div>
            <div class="hr">

            </div>
            <div class="container">
                <div class="fimFooter">
                    <span>© 2022 Melvs | A Solução da Sua Plantação</span>
                </div>
            </div>
        </footer>

</body>

</html>

<script>
    function cadastrar() {
        aguardar();

        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo
        var nomeVar = nome_input.value;
        var cpfVar = cpf_input.value;
        var emailVar = email_input.value;
        var senhaVar = senha_input.value;
        var confirmacaoSenhaVar = confirmacao_senha_input.value;

        if (nomeVar.length < 3) {
            span_validacao_nome.innerHTML = `Nome invalido`
        } else {
            span_validacao_nome.innerHTML = ''
        }

        if (emailVar.indexOf("@") > -1) {
            span_validacao_email.innerHTML = ''
        } else {
            span_validacao_email.innerHTML = `Email invalido`
        }

        if (cpfVar.length == 14) {
            span_validacao_cpf.innerHTML = ''
        } else {
            span_validacao_cpf.innerHTML = `CPF invalido`
        }

        if (senhaVar.length < 5) {
            span_validacao_senha.innerHTML = `Senha fraca`
        } else {
            span_validacao_senha.innerHTML = ''
        }

        if (confirmacaoSenhaVar != senhaVar) {
            span_validacao_confirme_senha.innerHTML = `Senha incorreta`
        } else {
            span_validacao_confirme_senha.innerHTML = ''

        }
        var bundinha = true
        if (nomeVar == "" || emailVar == "" || senhaVar == "" || confirmacaoSenhaVar == "" || cpfVar == '') {
            cardErro.style.display = "block"
            mensagem_erro.innerHTML = "(Mensagem de erro para todos os campos em branco)";
            bundinha = false
            finalizarAguardar();
            return false;
        }
        else {
            setInterval(sumirMensagem, 5000)
        }
        if (bundinha) {
            // Enviando o valor da nova input
            fetch("/usuarios/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    nomeServer: nomeVar,
                    cpfServer: cpfVar,
                    emailServer: emailVar,
                    senhaServer: senhaVar
                })
            }).then(function (resposta) {

                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    cardErro.style.display = "block";

                    /* mensagem_erro.innerHTML = "Cadastro realizado com sucesso! Redirecionando para tela de Login..."; */

                    setTimeout(() => {

                        window.location = "./tela_de_planos.html";
                    }, 2000)

                    limparFormulario();
                    finalizarAguardar();
                } else {
                    throw ("Houve um erro ao tentar realizar o cadastro!");
                }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
                finalizarAguardar();
            });

            return false;
        }

    }

    function sumirMensagem() {
        cardErro.style.display = "none"
    }

</script>

<script>
    function cadastro() {
        var email = email_input.value;
        var senha = input_senha.value;
        var nome = nome_input.value;
        var cpf = input_cpf.value;
        var senha = input_senha.value;
        var confirme_senha = confirmacao_senha_input.value;

        if (nome.length < 3) {
            span_validacao_nome.innerHTML = `Nome invalido`
        } else {
            span_validacao_nome.innerHTML = ''
        }

        if (email.indexOf("@") > -1) {
            span_validacao_email.innerHTML = ''
        } else {
            span_validacao_email.innerHTML = `Email invalido`
        }

        if (cpf.length == 14) {
            span_validacao_cpf.innerHTML = ''
        } else {
            span_validacao_cpf.innerHTML = `CPF invalido`
        }

        if (senha.length < 5) {
            span_validacao_senha.innerHTML = `Senha fraca`
        } else {
            span_validacao_senha.innerHTML = ''
        }

        if (confirme_senha != senha) {
            span_validacao_confirme_senha.innerHTML = `Senha incorreta`
        } else {
            span_validacao_confirme_senha.innerHTML = ''

        }
    }

    function cpfPontos() {
        var cpfz = cpf_input.value;
        var Digito1 = cpfz[0]
        var Digito2 = cpfz[1]
        var Digito3 = cpfz[2]
        var Digito4 = cpfz[3]
        var Digito5 = cpfz[4]
        var Digito6 = cpfz[5]
        var Digito7 = cpfz[6]
        var Digito8 = cpfz[7]
        var Digito9 = cpfz[8]
        var Digito10 = cpfz[9]
        var Digito11 = cpfz[10]
        var cpfInteiro = `${Digito1}${Digito2}${Digito3}.${Digito4}${Digito5}${Digito6}.${Digito7}${Digito8}${Digito9}-${Digito10}${Digito11}`
        if (cpfz.length == 11) {
            cpf_input.value = `${cpfInteiro}`
        }

    }
</script>